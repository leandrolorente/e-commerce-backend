generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ENUMS
enum UserRole {
  USER
  ADMIN
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  REFUNDED
}

enum PaymentMethod {
  PIX
  CREDIT_CARD
  DEBIT_CARD
  CASH
  BANK_TRANSFER
}

enum TattooStyle {
  OLD_SCHOOL
  REALISMO
  BLACKWORK
  AQUARELA
  MAORI
  JAPONES
  GEOMETRICO
  MINIMALISTA
  TRIBAL
  FINE_LINE
  PONTILHISMO
  ORNAMENTAL
}

enum TattooSize {
  PEQUENA
  MEDIA
  GRANDE
  EXTRA_GRANDE
}

enum ProductCategory {
  AFTERCARE
  CLOTHING
  ACCESSORIES
  EQUIPMENT
  GIFT_CARD
  ART
}

enum BodyArea {
  // Cabeça e Pescoço
  ROSTO
  PESCOCO
  NUCA
  
  // Tronco - Frente
  PEITO
  PEITO_SUPERIOR
  PEITO_LATERAL
  COSTELAS
  BARRIGA
  ABDOMEN
  
  // Tronco - Trás
  COSTAS
  COSTAS_SUPERIOR
  COSTAS_COMPLETAS
  LOMBAR
  
  // Braços
  BRACO
  BRACO_COMPLETO
  BRACO_SUPERIOR
  BRACO_INTERNO
  BRACO_EXTERNO
  ANTEBRACO
  ANTEBRACO_COMPLETO
  ANTEBRACO_INTERNO
  ANTEBRACO_EXTERNO
  COTOVELO
  
  // Mãos
  MAO
  MAO_COMPLETA
  DEDOS
  PULSO
  
  // Ombros
  OMBRO
  OMBRO_COMPLETO
  
  // Pernas
  PERNA_COMPLETA
  COXA
  COXA_INTERNA
  COXA_EXTERNA
  JOELHO
  PANTURRILHA
  CANELA
  
  // Pés
  PE
  PE_COMPLETO
  TORNOZELO
  DEDOS_PE
}

// MODELOS

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  phone     String?
  avatar    String?  // Para customerPhoto em testimonials
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders   Order[]
  bookings Booking[]
  reviews  Review[]

  @@map("users")
}

model Product {
  id             String          @id @default(uuid())
  name           String
  description    String
  price          Float
  discountPrice  Float?          // Preço com desconto
  stock          Int             @default(0)
  category       ProductCategory
  images         String[]        // Array de URLs de imagens
  specifications Json?           // Especificações técnicas
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  orderItems OrderItem[]
  reviews    Review[]

  @@map("products")
}

model Tattoo {
  id             String   @id @default(uuid())
  name           String   // Renomeado de title
  description    String?
  images         String[] // Array de URLs (antes era imageUrl)
  bodyArea       BodyArea
  style          String   // Ex: TRADITIONAL, REALISTIC, TRIBAL
  size           String   // Ex: SMALL, MEDIUM, LARGE
  estimatedTime  String   // Ex: "8h" (antes era duration em minutos)
  estimatedPrice Float    // Preço estimado (antes era price)
  artist         String   // Nome do artista (string simples)
  difficulty     String   // Ex: Beginner, Intermediate, Expert
  tags           String[] // Tags para busca
  colors         String[] // Cores utilizadas
  isAvailable    Boolean  @default(true) // Renomeado de isActive
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  bookings Booking[]
  reviews  Review[]

  @@map("tattoos")
}

model Artist {
  id          String   @id @default(uuid())
  name        String
  bio         String?
  specialty   String?
  imageUrl    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  bookings Booking[]

  @@map("artists")
}

model Booking {
  id        String        @id @default(uuid())
  userId    String
  artistId  String
  tattooId  String?
  service   String // "NOVA_TATUAGEM" | "RETOQUE" | "CONSULTA" | "COVER_UP"
  date      DateTime
  time      String
  status    BookingStatus @default(PENDING)
  notes     String?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  user   User    @relation(fields: [userId], references: [id])
  artist Artist  @relation(fields: [artistId], references: [id])
  tattoo Tattoo? @relation(fields: [tattooId], references: [id])

  @@map("bookings")
}

model Order {
  id              String      @id @default(uuid())
  userId          String
  total           Float
  status          OrderStatus @default(PENDING)
  shippingAddress String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  user    User        @relation(fields: [userId], references: [id])
  items   OrderItem[]
  payment Payment?

  @@map("orders")
}

model OrderItem {
  id        String @id @default(uuid())
  orderId   String
  productId String
  quantity  Int
  price     Float // preço no momento da compra

  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

model Payment {
  id                 String        @id @default(uuid())
  orderId            String        @unique
  amount             Float
  status             PaymentStatus @default(PENDING)
  paymentMethod      String? // "credit_card" | "pix" | "boleto"
  mercadoPagoId      String?       @unique
  mercadoPagoStatus  String?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt

  order Order @relation(fields: [orderId], references: [id])

  @@map("payments")
}

model Review {
  id        String   @id @default(uuid())
  userId    String
  productId String?
  tattooId  String?
  rating    Int      // 1-5
  comment   String?
  service   String?  // Tipo de serviço/produto para testimonials
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User     @relation(fields: [userId], references: [id])
  product Product? @relation(fields: [productId], references: [id])
  tattoo  Tattoo?  @relation(fields: [tattooId], references: [id])

  @@map("reviews")
}
